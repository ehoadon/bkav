<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billcode Comparator Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f4f4f4; color: #333; padding: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; color: #0066cc; margin-bottom: 20px; }
        .section { margin-bottom: 20px; }
        .section label { font-weight: bold; display: block; margin-bottom: 5px; }
        .section textarea { width: 100%; height: 150px; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; resize: vertical; }
        .button { background: #0066cc; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .button:hover { background: #004b99; }
        .result { margin-top: 20px; padding: 10px; background: #e9f3ff; border-radius: 4px; display: none; }
        .result h3 { color: #0066cc; margin-bottom: 10px; }
        .result ul { margin-left: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Billcode Comparator Tool</h1>
        <p style="text-align: center;">So s√°nh Billcode gi·ªØa B·∫£ng A v√† B·∫£ng B.</p>

        <div class="section">
            <label for="tableA">B·∫£ng A (D·ªØ li·ªáu A)</label>
            <textarea id="tableA" placeholder="Nh·∫≠p Billcode (c√°ch nhau b·∫±ng ph·∫©y ho·∫∑c xu·ªëng d√≤ng, v√≠ d·ª•: 123, 124, 1345)"></textarea>
        </div>

        <div class="section">
            <label for="tableB">B·∫£ng B (D·ªØ li·ªáu B)</label>
            <textarea id="tableB" placeholder="Nh·∫≠p Billcode (c√°ch nhau b·∫±ng ph·∫©y ho·∫∑c xu·ªëng d√≤ng, v√≠ d·ª•: 123, 124, 1345)"></textarea>
        </div>

        <div class="section">
            <button class="button" onclick="compareBillcodes()">So s√°nh</button>
        </div>

        <div class="result" id="result">
            <h3>K·∫øt qu·∫£ so s√°nh</h3>
            <p>Billcode kh√°c bi·ªát:</p>
            <ul id="resultList"></ul>
        </div>
    </div>

<script>
    /**
     * H√†m t√¨m c√°c billcode b·ªã tr√πng l·∫∑p trong m·ªôt m·∫£ng.
     * @param {string[]} billcodeArray - M·∫£ng c√°c billcode ƒë·∫ßu v√†o.
     * @returns {object[]} - M·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng, m·ªói ƒë·ªëi t∆∞·ª£ng ch·ª©a billcode v√† s·ªë l·∫ßn l·∫∑p.
     */
    const findDuplicates = (billcodeArray) => {
        const counts = {};
        for (const code of billcodeArray) {
            if (code) {
                counts[code] = (counts[code] || 0) + 1;
            }
        }
        const duplicates = [];
        for (const code in counts) {
            if (counts[code] > 1) {
                duplicates.push({ code: code, count: counts[code] });
            }
        }
        return duplicates;
    };

    function compareBillcodes() {
        // L·∫•y d·ªØ li·ªáu
        const tableAInput = document.getElementById('tableA').value;
        const tableBInput = document.getElementById('tableB').value;

        const extractBillcodes = (inputString) => {
            if (!inputString.trim()) return [];
            return inputString
                .split(/[,|\n]+/)
                .map(item => item.trim())
                .filter(item => item);
        };

        const billcodesA_raw = extractBillcodes(tableAInput);
        const billcodesB_raw = extractBillcodes(tableBInput);

        if (billcodesA_raw.length === 0 && billcodesB_raw.length === 0) {
            alert('Vui l√≤ng nh·∫≠p d·ªØ li·ªáu Billcode h·ª£p l·ªá!');
            return;
        }

        const duplicatesInA = findDuplicates(billcodesA_raw);
        const duplicatesInB = findDuplicates(billcodesB_raw);

        const setA = new Set(billcodesA_raw);
        const setB = new Set(billcodesB_raw);

        // --- T√çNH TO√ÅN ---
        // **M·ªöI: T√¨m c√°c billcode kh·ªõp nhau (c√≥ ·ªü c·∫£ 2 b·∫£ng)**
        const matchingCodes = [...setA].filter(code => setB.has(code));

        // T√¨m c√°c billcode kh√°c bi·ªát
        const diffA = [...setA].filter(code => !setB.has(code));
        const diffB = [...setB].filter(code => !setA.has(code));

        // --- HI·ªÇN TH·ªä K·∫æT QU·∫¢ ---
        const resultDiv = document.getElementById('result');
        const resultList = document.getElementById('resultList');
        resultList.innerHTML = ''; 

        let hasContent = false;

        // **M·ªöI: 1. Hi·ªÉn th·ªã c√°c billcode kh·ªõp nhau**
        if (matchingCodes.length > 0) {
            resultList.innerHTML += `<li>‚úÖ **C√°c Billcode kh·ªõp nhau** (${matchingCodes.length}): ${matchingCodes.join(', ')}</li>`;
            hasContent = true;
        }
        
        // 2. Hi·ªÉn th·ªã k·∫øt qu·∫£ so s√°nh kh√°c bi·ªát
        if (diffA.length > 0) {
            resultList.innerHTML += `<li>üî¥ **C√°c Billcode ch·ªâ c√≥ ·ªü B·∫£ng A** (${diffA.length}): ${diffA.join(', ')}</li>`;
            hasContent = true;
        }
        if (diffB.length > 0) {
            resultList.innerHTML += `<li>üîµ **C√°c Billcode ch·ªâ c√≥ ·ªü B·∫£ng B** (${diffB.length}): ${diffB.join(', ')}</li>`;
            hasContent = true;
        }
        
        // 3. Hi·ªÉn th·ªã k·∫øt qu·∫£ ph√¢n t√≠ch tr√πng l·∫∑p
        if (duplicatesInA.length > 0 || duplicatesInB.length > 0) {
            hasContent = true;
            // Th√™m d√≤ng k·∫ª n·∫øu c√≥ c√°c k·∫øt qu·∫£ kh√°c
            if (matchingCodes.length > 0 || diffA.length > 0 || diffB.length > 0) {
                 resultList.innerHTML += '<hr style="margin: 10px 0;">';
            }
            resultList.innerHTML += '<p style="font-weight: bold; margin-bottom: 5px;">üîé Ph√¢n t√≠ch tr√πng l·∫∑p:</p>';
            if(duplicatesInA.length > 0) {
                const dupA_str = duplicatesInA.map(item => `${item.code} (l·∫∑p ${item.count} l·∫ßn)`).join('; ');
                resultList.innerHTML += `<li><strong>Trong B·∫£ng A:</strong> ${dupA_str}</li>`;
            }
            if(duplicatesInB.length > 0) {
                const dupB_str = duplicatesInB.map(item => `${item.code} (l·∫∑p ${item.count} l·∫ßn)`).join('; ');
                resultList.innerHTML += `<li><strong>Trong B·∫£ng B:</strong> ${dupB_str}</li>`;
            }
        }
        
        // N·∫øu kh√¥ng c√≥ n·ªôi dung n√†o ƒë∆∞·ª£c t·∫°o ra
        if (!hasContent) {
            resultList.innerHTML = '<li>üëç Ho√†n h·∫£o! Hai b·∫£ng c√≥ d·ªØ li·ªáu gi·ªëng h·ªát nhau v√† kh√¥ng c√≥ bill n√†o b·ªã tr√πng l·∫∑p.</li>';
        }

        resultDiv.style.display = 'block';
    }
</script>
</body>
</html>
