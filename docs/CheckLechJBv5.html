<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng c·ª• So s√°nh File Excel</title>
    <link rel="stylesheet" href="https://unpkg.com/filepond/dist/filepond.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/filepond/dist/filepond.min.js"></script>
    <script src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.min.js"></script>
    <script src="https://unpkg.com/papaparse/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.0/spark-md5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script>
      // Fallback n·∫øu CDN kh√¥ng t·∫£i ƒë∆∞·ª£c
      if (typeof Chart === 'undefined') {
        document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.4/chart.min.js"><\/script>');
      }
    </script>
    <style>
        :root {
            --primary: #007bff;
            --primary-hover: #0056b3;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa; /* N·ªÅn s√°ng */
            --dark: #343a40; /* VƒÉn b·∫£n t·ªëi */
            --border: #dee2e6; /* Vi·ªÅn s√°ng */
            --shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
            --border-radius: 0.375rem;
            --transition: all 0.15s ease-in-out;
        }

        [data-theme="dark"] {
            --light: #212529; /* N·ªÅn t·ªëi ƒë·∫≠m h∆°n */
            --dark: #e0e0e0; /* VƒÉn b·∫£n s√°ng h∆°n */
            --border: #495057; /* Vi·ªÅn t·ªëi */
            --primary: #4dabf7; /* T√¥ng xanh nh·∫°t h∆°n trong t·ªëi */
            --primary-hover: #339af0;
            --success: #20c997; /* Xanh l√° nh·∫°t h∆°n */
            --danger: #e74c3c; /* ƒê·ªè nh·∫°t h∆°n */
            --warning: #f1c40f; /* V√†ng nh·∫°t h∆°n */
            --info: #1abc9c; /* Xanh ng·ªçc nh·∫°t h∆°n */
            --shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.2); /* B√≥ng t·ªëi h∆°n */
            --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.3);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark); /* M√†u ch·ªØ thay ƒë·ªïi theo ch·∫ø ƒë·ªô */
            transition: var(--transition);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--light); /* N·ªÅn thay ƒë·ªïi theo ch·∫ø ƒë·ªô */
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--dark); /* Vi·ªÅn d·ª±a tr√™n m√†u ch·ªØ */
            color: var(--dark);
        }

        .btn-outline:hover {
            background: var(--dark);
            color: var(--light);
        }

        .content {
            padding: 2rem;
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .upload-box {
            border: 2px dashed var(--border);
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            transition: var(--transition);
            background: var(--light); /* N·ªÅn thay ƒë·ªïi theo ch·∫ø ƒë·ªô */
        }

        .upload-box:hover {
            border-color: var(--primary);
            background: color-mix(in srgb, var(--light) 90%, var(--primary) 10%);
        }

        .upload-box.dragover {
            border-color: var(--success);
            background: color-mix(in srgb, var(--light) 90%, var(--success) 10%);
        }

        .file-info {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--info);
            color: var(--dark); /* ƒê·∫£m b·∫£o ch·ªØ trong file-info r√µ n√©t */
        }

        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--info));
            width: 0%;
            transition: width 0.3s ease;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .language-selector {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .language-selector select {
            padding: 0.5rem;
            border: 2px solid var(--border);
            border-radius: var(--border-radius);
            background: var(--light);
            font-size: 0.875rem;
            cursor: pointer;
            color: var(--dark); /* ƒê·∫£m b·∫£o ch·ªØ trong select r√µ n√©t */
        }

        .results {
            margin-top: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Gi·∫£m minmax ƒë·ªÉ v·ª´a 5 c·ªôt */
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* T·ªëi ∆∞u cho m√†n h√¨nh nh·ªè */
            }
        }

        .stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            border-left: 4px solid var(--primary);
            color: var(--dark);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            color: color-mix(in srgb, var(--dark) 60%, var(--light) 40%); /* M√†u nh√£n nh·∫°t h∆°n */
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .filters {
            background: var(--light);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--dark); /* ƒê·∫£m b·∫£o nh√£n r√µ n√©t */
        }

        .form-control {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            background: var(--light);
            color: var(--dark); /* ƒê·∫£m b·∫£o ch·ªØ trong input r√µ n√©t */
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .form-control::placeholder {
            color: color-mix(in srgb, var(--dark) 40%, var(--light) 60%); /* Placeholder nh·∫°t h∆°n */
        }

        .accordion {
            margin-top: 1rem;
        }

        .accordion-item {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .accordion-header {
            background: color-mix(in srgb, var(--light) 90%, var(--primary) 10%);
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            color: var(--dark); /* ƒê·∫£m b·∫£o ti√™u ƒë·ªÅ accordion r√µ n√©t */
            transition: var(--transition);
        }

        .accordion-header:hover {
            background: color-mix(in srgb, var(--light) 80%, var(--primary) 20%);
        }

        .accordion-content {
            padding: 1.5rem;
            color: var(--dark); /* ƒê·∫£m b·∫£o n·ªôi dung accordion r√µ n√©t */
        }

        .accordion-item.active .accordion-content {
            display: block;
        }

        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

        .table-container {
            overflow-x: auto;
            margin: 1rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--light);
            font-size: 0.875rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
            color: var(--dark); /* ƒê·∫£m b·∫£o ch·ªØ trong b·∫£ng r√µ n√©t */
        }

        th {
            background: color-mix(in srgb, var(--light) 90%, var(--primary) 10%);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:hover {
            background: color-mix(in srgb, var(--light) 90%, var(--primary) 10%);
        }

        .badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: white; /* ƒê·∫£m b·∫£o ch·ªØ trong badge r√µ n√©t */
        }

        .badge-success {
            background: var(--success);
        }

        .badge-danger {
            background: var(--danger);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .pagination button {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            background: var(--light);
            cursor: pointer;
            border-radius: var(--border-radius);
            color: var(--dark); /* ƒê·∫£m b·∫£o ch·ªØ trong pagination r√µ n√©t */
            transition: var(--transition);
        }

        .pagination button:hover:not(:disabled) {
            background: var(--primary);
            color: var(--light);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination span {
            color: var(--dark); /* ƒê·∫£m b·∫£o ch·ªØ trong span pagination r√µ n√©t */
        }

        .chart-container {
            display: flex;
            align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
            justify-content: space-between; /* Ph√¢n c√°ch ƒë·ªÅu gi·ªØa canvas v√† chi ti·∫øt */
            max-width: 600px;
            margin: 1rem auto;
            padding: 1.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        .chart-wrapper {
            flex: 1; /* Chi·∫øm kh√¥ng gian linh ho·∫°t */
        }
        .chart-details {
            flex: 1; /* Chi·∫øm kh√¥ng gian ngang b·∫±ng v·ªõi canvas */
            margin-left: 20px; /* Kho·∫£ng c√°ch gi·ªØa bi·ªÉu ƒë·ªì v√† chi ti·∫øt */
            padding: 10px; /* Th√™m padding cho ƒë·∫πp */
        }

        .chart-details ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .chart-details li {
            margin-bottom: 5px; /* Kho·∫£ng c√°ch gi·ªØa c√°c d√≤ng */
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            color: var(--dark); /* ƒê·∫£m b·∫£o ch·ªØ trong loading r√µ n√©t */
        }

        .spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid var(--light);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            border: 1px solid;
            color: var(--dark); /* ƒê·∫£m b·∫£o ch·ªØ trong alert r√µ n√©t */
        }

        .alert-success {
            background: color-mix(in srgb, #d4edda 90%, var(--light) 10%);
            border-color: #c3e6cb;
            color: var(--success);
        }

        .alert-danger {
            background: color-mix(in srgb, #f8d7da 90%, var(--light) 10%);
            border-color: #f5c6cb;
            color: var(--danger);
        }

        .alert-warning {
            background: color-mix(in srgb, #fff3cd 90%, var(--light) 10%);
            border-color: #ffeaa7;
            color: var(--warning);
        }

        .alert-info {
            background: color-mix(in srgb, #d1ecf1 90%, var(--light) 10%);
            border-color: #bee5eb;
            color: var(--info);
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: var(--light); /* ƒê·∫£m b·∫£o ch·ªØ trong tooltip r√µ n√©t */
            padding: 0.5rem;
            border-radius: var(--border-radius);
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            
            .upload-section {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .controls {
                position: static;
                margin-top: 1rem;
                justify-content: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <div class="language-selector">
        <select id="langSelect">
            <option value="vi">üáªüá≥ Ti·∫øng Vi·ªát</option>
            <option value="en">üá¨üáß English</option>
            <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
            <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
            <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
            <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
        </select>
    </div>

    <div class="container">
        <div class="header">
            <div class="controls">
                <button class="btn btn-outline" id="themeToggleBtn">
                    <span id="themeIcon">üåô</span>
                </button>
                <button class="btn btn-outline" id="helpBtn">
                    <span>‚ùì</span>
                </button>
            </div>
            <h1 id="title">C√¥ng c·ª• So s√°nh File Excel</h1>
            <p id="subtitle">Ph√¢n t√≠ch v√† so s√°nh d·ªØ li·ªáu t·ª´ hai file Excel/CSV</p>
        </div>

        <div class="content">
            <div class="upload-section">
                <div class="upload-box" id="uploadBox1">
                    <div class="upload-icon">üìä</div>
                    <h3 id="file1Title">File 1: Excel POS Jollibee</h3>
                    <p id="file1Desc">K√©o th·∫£ file ho·∫∑c click ƒë·ªÉ ch·ªçn</p>
                    <input type="file" id="file1" accept=".xlsx,.xls,.csv" style="display: none">
                    <button class="btn btn-primary" id="selectFile1Btn">Ch·ªçn File</button>
                    <div id="file1Info" class="file-info" style="display: none"></div>
                    <div id="progress1" class="progress-bar" style="display: none">
                        <div class="progress"></div>
                    </div>
                </div>

                <div class="upload-box" id="uploadBox2">
                    <div class="upload-icon">üìà</div>
                    <h3 id="file2Title">File 2: Excel DLBH Bkav</h3>
                    <p id="file2Desc">K√©o th·∫£ file ho·∫∑c click ƒë·ªÉ ch·ªçn</p>
                    <input type="file" id="file2" accept=".xlsx,.xls,.csv" style="display: none">
                    <button class="btn btn-primary" id="selectFile2Btn">Ch·ªçn File</button>
                    <div id="file2Info" class="file-info" style="display: none"></div>
                    <div id="progress2" class="progress-bar" style="display: none">
                        <div class="progress"></div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" id="compareBtn" disabled>
                    <span>üîç</span> So s√°nh
                </button>
                <button class="btn btn-success" id="exportBtn" disabled>
                    <span>üì§</span> Xu·∫•t Excel
                </button>
                <button class="btn btn-danger" id="refreshBtn">
                    <span>üîÑ</span> L√†m m·ªõi
                </button>
                <button class="btn btn-primary" id="saveTemplateBtn">
                    <span>üíæ</span> L∆∞u m·∫´u
                </button>
            </div>

            <div id="results" class="results" style="display: none">
                <div class="stats-grid" id="statsGrid"></div>                
                <div class="filters" id="filtersSection">
                    <h4 id="filtersTitle">üîß</h4>
                    <div class="filter-row">
                        <div class="form-group">
                            <label for="validityFilter" id="validityFilterLabel"></label>
                            <select id="validityFilter" class="form-control">
                                <option value="all">[T·∫•t c·∫£]</option>
                                <option value="valid">[H·ª£p l·ªá]</option>
                                <option value="invalid">[Kh√¥ng h·ª£p l·ªá]</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="billcodeSearch" id="billcodeSearchLabel"></label>
                            <input type="text" id="billcodeSearch" class="form-control" placeholder="[Nh·∫≠p Billcode]">
                        </div>
                        <div class="form-group">
                            <label for="diffFilter" id="diffFilterLabel"></label>
                            <input type="number" id="diffFilter" class="form-control" placeholder="[Ch√™nh l·ªách t·ªëi thi·ªÉu]">
                        </div>
                        <div class="form-group">
                            <label> </label>
                            <button class="btn btn-primary" id="clearFiltersBtn">[X√≥a b·ªô l·ªçc]</button>
                        </div>
                    </div>
                </div>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <canvas id="validityChart" width="300" height="150"></canvas>
                </div>
                <div id="chartDetails" class="chart-details"></div>
            </div>
                </div>
                <div class="accordion" id="resultsAccordion"></div>
            </div>

            <div id="loading" class="loading" style="display: none">
                <div class="spinner"></div>
                <span style="margin-left: 1rem">ƒêang x·ª≠ l√Ω...</span>
            </div>
        </div>
    </div>

    <script>
            const translations = {
                vi: {
                    title: 'C√¥ng c·ª• So s√°nh File Excel',
                    subtitle: 'Ph√¢n t√≠ch v√† so s√°nh d·ªØ li·ªáu t·ª´ hai file Excel/CSV',
                    file1Title: 'File 1: Excel POS Jollibee',
                    file2Title: 'File 2: Excel DLBH Bkav',
                    selectFile1Btn: 'Ch·ªçn File',
                    file1Desc: 'K√©o th·∫£ file ho·∫∑c click ƒë·ªÉ ch·ªçn',
                    file2Desc: 'K√©o th·∫£ file ho·∫∑c click ƒë·ªÉ ch·ªçn',
                    compare: 'So s√°nh',
                    export: 'Xu·∫•t Excel',
                    refresh: 'L√†m m·ªõi',
                    saveTemplate: 'L∆∞u m·∫´u',
                    processing: 'ƒêang x·ª≠ l√Ω...',
                    valid: 'H·ª£p l·ªá',
                    invalid: 'Kh√¥ng h·ª£p l·ªá',
                    all: 'T·∫•t c·∫£',
                    noData: 'Kh√¥ng c√≥ d·ªØ li·ªáu',
                    stats: {
                        total: 'T·ªïng s·ªë b·∫£n ghi',
                        matched: 'Kh·ªõp',
                        unmatched: 'Kh√¥ng kh·ªõp',
                        diffAmount: 'Ch√™nh l·ªách t·ªïng',
                        notTaken: 'Kh√¥ng l·∫•y',
                        otherSvc: 'Ph√≠ giao h√†ng',
                        adjustedTotalDiff: 'Ch√™nh l·ªách Kh√¥ng ph√≠ giao',
                        duplicates: 'Tr√πng l·∫∑p'
                    },
                    table: {
                        billcode: 'Billcode',
                        occurrences: 'S·ªë l·∫ßn xu·∫•t hi·ªán',
                        amount1: 'S·ªë ti·ªÅn File 1',
                        amount2: 'S·ªë ti·ªÅn File 2',
                        difference: 'Ch√™nh l·ªách',
                        status: 'Tr·∫°ng th√°i',
                        validStatus: 'Tr·∫°ng th√°i',
                        otherSvc: 'Ph√≠ giao h√†ng',
                        reason: 'L√Ω do',
                        other_svc_ttl: 'Ph√≠ giao h√†ng',
                        chk_seq: 'chk_seq',
                        file: 'File',
                        file1Count: 'S·ªë l·∫ßn xu·∫•t hi·ªán File 1',
                        file2Count: 'S·ªë l·∫ßn xu·∫•t hi·ªán File 2',
                        details: 'Chi ti·∫øt',
                        statusInFile1: 'Tr√πng trong File 1',
                        statusInFile2: 'Tr√πng trong File 2',
                        statusBetweenFiles: 'Tr√πng gi·ªØa File 1 v√† File 2',
                        property: 'T√≠nh ch·∫•t'            
                    },
                    filter: {
                        validity: 'T√≠nh h·ª£p l·ªá',
                        billcodeSearch: 'T√¨m ki·∫øm Billcode',
                        diffFilter: 'Ch√™nh l·ªách t·ªëi thi·ªÉu',
                        clearFilters: 'X√≥a b·ªô l·ªçc',
                        filtersTitle: 'L·ªçc'
                    },
                    accordion: {
                        missingInFile2: 'Billcode c√≥ ·ªü File 1 nh∆∞ng kh√¥ng c√≥ ·ªü File 2',
                        missingInFile1: 'Billcode c√≥ ·ªü File 2 nh∆∞ng kh√¥ng c√≥ ·ªü File 1',
                        valueDiffs: 'Billcode c√≥ gi√° tr·ªã ch√™nh l·ªách',
                        duplicates: 'Billcode tr√πng l·∫∑p'
                    },
                    alert: {
                        success: 'Th√†nh c√¥ng: %s',
                        error: 'L·ªói: %s',
                        warning: 'C·∫£nh b√°o: %s',
                        info: 'Th√¥ng tin: %s'
                    },
                    fileInfo: {
                        size: 'K√≠ch th∆∞·ªõc',
                        data: 'D·ªØ li·ªáu',
                        rows: 'h√†ng',
                        columns: 'c·ªôt'
                    },
                    pagination: {
                        page: 'Trang'
                    }
                },
                en: {
                    title: 'Excel File Comparison Tool',
                    subtitle: 'Accurately analyze and compare data from two Excel/CSV files',
                    file1Title: 'File 1: Jollibee POS Excel',
                    file2Title: 'File 2: Bkav DLBH Excel',
                    file1Desc: 'Drag and drop file or click to select',
                    file2Desc: 'Drag and drop file or click to select',
                    selectFile1Btn: 'Open File',
                    compare: 'Compare',
                    export: 'Export to Excel',
                    refresh: 'Refresh',
                    saveTemplate: 'Save Template',
                    processing: 'Processing...',
                    valid: 'Valid',
                    invalid: 'Invalid',
                    all: 'All',
                    noData: 'No data available',
                    stats: {
                        total: 'Total Records',
                        matched: 'Matched',
                        unmatched: 'Unmatched',
                        diffAmount: 'Total Difference',
                        notTaken: 'Not Taken',
                        otherSvc: 'Delivery fee',
                        adjustedTotalDiff: 'Shipping fee difference',
                        duplicates: 'Duplicate Billcodes'
                    },
                    table: {
                        billcode: 'Billcode',
                        occurrences: 'Occurrences',
                        amount1: 'Amount File 1',
                        amount2: 'Amount File 2',
                        difference: 'Difference',
                        status: 'Status',
                        reason: 'Reason',
                        other_svc_ttl: 'Delivery fee',
                        chk_seq: 'chk_seq',
                        file: 'File',
                        file1Count: 'File 1 Count',
                        file2Count: 'File 2 Count',
                        details: 'Details',
                        statusInFile1: 'Duplicate in File 1',
                        statusInFile2: 'Duplicate in File 2',
                        statusBetweenFiles: 'Duplicate between File 1 and File 2',
                        property: 'Property'
                    },
                    filter: {
                        validity: 'Validity',
                        billcodeSearch: 'Search Billcode',
                        diffFilter: 'Minimum Difference',
                        clearFilters: 'Clear Filters',
                        duplicates: 'Duplicate Billcodes',
                        filtersTitle: 'Filters'
                    },
                    accordion: {
                        missingInFile2: 'Billcodes in File 1 but not in File 2',
                        missingInFile1: 'Billcodes in File 2 but not in File 1',
                        valueDiffs: 'Billcodes with Value Differences',
                        duplicates: ' Duplicate Billcodes'
                    },
                    alert: {
                        success: 'Success: %s',
                        error: 'Error: %s',
                        warning: 'Warning: %s',
                        info: 'Info: %s'
                    },
                    fileInfo: {
                        size: 'Size',
                        data: 'Data',
                        rows: 'rows',
                        columns: 'columns'
                     },
                     pagination: {
                        page: 'Page'
                    }
                },
                zh: {
                    title: 'ExcelÊñá‰ª∂ÊØîËæÉÂ∑•ÂÖ∑',
                    subtitle: 'Á≤æÁ°ÆÂàÜÊûêÂíåÊØîËæÉ‰∏§‰∏™Excel/CSVÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ',
                    file1Title: 'Êñá‰ª∂1ÔºöJollibee POS Excel',
                    file2Title: 'Êñá‰ª∂2ÔºöBkav DLBH Excel',
                    file1Desc: 'ÊãñÊîæÊñá‰ª∂ÊàñÁÇπÂáªÈÄâÊã©',
                    file2Desc: 'ÊãñÊîæÊñá‰ª∂ÊàñÁÇπÂáªÈÄâÊã©',
                    compare: 'ÊØîËæÉ',
                    export: 'ÂØºÂá∫Âà∞Excel',
                    refresh: 'Âà∑Êñ∞',
                    saveTemplate: '‰øùÂ≠òÊ®°Êùø',
                    processing: 'Â§ÑÁêÜ‰∏≠...',
                    valid: 'ÊúâÊïà',
                    invalid: 'Êó†Êïà',
                    all: 'ÂÖ®ÈÉ®',
                    noData: 'Ê≤°ÊúâÊï∞ÊçÆ',
                    stats: {
                        total: 'ÊÄªËÆ∞ÂΩïÊï∞',
                        matched: 'ÂåπÈÖç',
                        unmatched: '‰∏çÂåπÈÖç',
                        diffAmount: 'ÊÄªÂ∑ÆÈ¢ù',
                        notTaken: 'Êú™Âèñ',
                        otherSvc: 'ËøêË¥π',
                        adjustedTotalDiff: 'ËøêË¥πÂ∑ÆÂºÇ',
                        duplicates: 'ÈáçÂ§ç'
                    },
                    table: {
                        billcode: 'Ë¥¶Âçï‰ª£Á†Å',
                        amount1: 'Êñá‰ª∂1ÈáëÈ¢ù',
                        amount2: 'Êñá‰ª∂2ÈáëÈ¢ù',
                        difference: 'Â∑ÆÈ¢ù',
                        status: 'Áä∂ÊÄÅ',
                        reason: 'ÂéüÂõ†',
                        other_svc_ttl: 'ËøêË¥π',
                        otherSvc: 'ËøêË¥π',
                        property: 'Â±ûÊÄß',
                        details: 'ËØ¶ÁªÜ‰ø°ÊÅØ',
                        file1Count: 'Êñá‰ª∂ 1 Âá∫Áé∞Ê¨°Êï∞',
                        file2Count: 'Êñá‰ª∂ 2 Âá∫Áé∞Ê¨°Êï∞'
                    },
                    filter: {
                        validity: 'ÊúâÊïàÊÄß',
                        billcodeSearch: 'ÊêúÁ¥¢Ë¥¶Âçï‰ª£Á†Å',
                        diffFilter: 'ÊúÄÂ∞èÂ∑ÆÈ¢ù',
                        clearFilters: 'Ê∏ÖÈô§ËøáÊª§Âô®',
                        filtersTitle: 'Á≠õÈÄâ'
                    },
                    accordion: {
                        missingInFile2: 'Êñá‰ª∂1‰∏≠Êúâ‰ΩÜÊñá‰ª∂2‰∏≠Ê≤°ÊúâÁöÑË¥¶Âçï‰ª£Á†Å',
                        missingInFile1: 'Êñá‰ª∂2‰∏≠Êúâ‰ΩÜÊñá‰ª∂1‰∏≠Ê≤°ÊúâÁöÑË¥¶Âçï‰ª£Á†Å',
                        valueDiffs: 'ÂÖ∑Êúâ‰ª∑ÂÄºÂ∑ÆÂºÇÁöÑË¥¶Âçï‰ª£Á†Å',
                        duplicates: 'ÈáçÂ§çÁöÑË¥¶Âçï‰ª£Á†Å'
                    },
                    alert: {
                        success: 'ÊàêÂäüÔºö%s',
                        error: 'ÈîôËØØÔºö%s',
                        warning: 'Ë≠¶ÂëäÔºö%s',
                        info: '‰ø°ÊÅØÔºö%s'
                    },
                    fileInfo: {
                        size: 'Â§ßÂ∞è',
                        data: 'Êï∞ÊçÆ',
                        rows: 'Ë°å',
                        columns: 'Âàó'
                    },
                    pagination: {
                        page: 'È°µ'
                    }
                },
                ja: {
                    title: 'Excel„Éï„Ç°„Ç§„É´ÊØîËºÉ„ÉÑ„Éº„É´',
                    subtitle: '2„Å§„ÅÆExcel/CSV„Éï„Ç°„Ç§„É´„ÅÆ„Éá„Éº„Çø„ÇíÊ≠£Á¢∫„Å´ÂàÜÊûê„Åä„Çà„Å≥ÊØîËºÉ„Åó„Åæ„Åô',
                    file1Title: '„Éï„Ç°„Ç§„É´1ÔºöJollibee POS Excel',
                    file2Title: '„Éï„Ç°„Ç§„É´2ÔºöBkav DLBH Excel',
                    file1Desc: '„Éï„Ç°„Ç§„É´„Çí„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó„Åæ„Åü„ÅØ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÅ∏Êäû',
                    file2Desc: '„Éï„Ç°„Ç§„É´„Çí„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó„Åæ„Åü„ÅØ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÅ∏Êäû',
                    compare: 'ÊØîËºÉ',
                    export: 'Excel„Å´„Ç®„ÇØ„Çπ„Éù„Éº„Éà',
                    refresh: '„É™„Éï„É¨„ÉÉ„Ç∑„É•',
                    saveTemplate: '„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí‰øùÂ≠ò',
                    processing: 'Âá¶ÁêÜ‰∏≠...',
                    valid: 'ÊúâÂäπ',
                    invalid: 'ÁÑ°Âäπ',
                    all: '„Åô„Åπ„Å¶',
                    noData: '„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì',
                    stats: {
                        total: 'Á∑è„É¨„Ç≥„Éº„ÉâÊï∞',
                        matched: '‰∏ÄËá¥',
                        unmatched: '‰∏ç‰∏ÄËá¥',
                        diffAmount: 'Á∑èÂ∑ÆÈ°ç',
                        notTaken: 'ÂèñÂæó„Åó„Å™„ÅÑ',
                        otherSvc: 'ÈÖçÈÅîÊñô',
                        adjustedTotalDiff: 'ÈÄÅÊñô„ÅÆÂ∑Æ',
                        duplicates: 'ÈáçË§á'
                    },
                    table: {
                        billcode: '„Éì„É´„Ç≥„Éº„Éâ',
                        amount1: '„Éï„Ç°„Ç§„É´1„ÅÆÈáëÈ°ç',
                        amount2: '„Éï„Ç°„Ç§„É´2„ÅÆÈáëÈ°ç',
                        difference: 'Â∑ÆÈ°ç',
                        status: '„Çπ„ÉÜ„Éº„Çø„Çπ',
                        reason: 'ÁêÜÁî±',
                        other_svc_ttl: 'ÈÖçÈÅîÊñô',
                        otherSvc: 'ÈÖçÈÅîÊñô',
                        property: 'ÁâπÊÄß',
                        details: 'Ë©≥Á¥∞',
                        file1Count: '„Éï„Ç°„Ç§„É´1„ÅÆÂá∫ÁèæÂõûÊï∞',
                        file2Count: '„Éï„Ç°„Ç§„É´2„ÅÆÂá∫ÁèæÂõûÊï∞'
                    },
                    filter: {
                        validity: 'ÊúâÂäπÊÄß',
                        billcodeSearch: '„Éì„É´„Ç≥„Éº„ÉâÊ§úÁ¥¢',
                        diffFilter: 'ÊúÄÂ∞èÂ∑ÆÈ°ç',
                        clearFilters: '„Éï„Ç£„É´„Çø„Éº„Çí„ÇØ„É™„Ç¢',
                        filtersTitle: '„Éï„Ç£„É´„Çø„Éº'
                    },
                    accordion: {
                        missingInFile2: '„Éï„Ç°„Ç§„É´1„Å´„ÅÇ„Çä„ÄÅ„Éï„Ç°„Ç§„É´2„Å´„Å™„ÅÑ„Éì„É´„Ç≥„Éº„Éâ',
                        missingInFile1: '„Éï„Ç°„Ç§„É´2„Å´„ÅÇ„Çä„ÄÅ„Éï„Ç°„Ç§„É´1„Å´„Å™„ÅÑ„Éì„É´„Ç≥„Éº„Éâ',
                        valueDiffs: '‰æ°ÂÄ§„ÅÆÂ∑Æ„Åå„ÅÇ„Çã„Éì„É´„Ç≥„Éº„Éâ',
                        duplicates: 'ÈáçË§á„Åó„ÅüË´ãÊ±Ç„Ç≥„Éº„Éâ'
                    },
                    alert: {
                        success: 'ÊàêÂäüÔºö%s',
                        error: '„Ç®„É©„ÉºÔºö%s',
                        warning: 'Ë≠¶ÂëäÔºö%s',
                        info: 'ÊÉÖÂ†±Ôºö%s'
                    },
                    fileInfo: {
                        size: '„Çµ„Ç§„Ç∫',
                        data: '„Éá„Éº„Çø',
                        rows: 'Ë°å',
                        columns: 'Âàó'
                    },
                    pagination: {
                        page: '„Éö„Éº„Ç∏'
                    }
                },
                ko: {
                    title: 'ÏóëÏÖÄ ÌååÏùº ÎπÑÍµê ÎèÑÍµ¨',
                    subtitle: 'Îëê Í∞úÏùò Excel/CSV ÌååÏùº Îç∞Ïù¥ÌÑ∞Î•º Ï†ïÌôïÌûà Î∂ÑÏÑù Î∞è ÎπÑÍµê',
                    file1Title: 'ÌååÏùº 1: Jollibee POS Excel',
                    file2Title: 'ÌååÏùº 2: Bkav DLBH Excel',
                    file1Desc: 'ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ÌïòÍ±∞ÎÇò ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù',
                    file2Desc: 'ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ÌïòÍ±∞ÎÇò ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù',
                    compare: 'ÎπÑÍµê',
                    export: 'ExcelÎ°ú ÎÇ¥Î≥¥ÎÇ¥Í∏∞',
                    refresh: 'ÏÉàÎ°úÍ≥†Ïπ®',
                    saveTemplate: 'ÌÖúÌîåÎ¶ø Ï†ÄÏû•',
                    processing: 'Ï≤òÎ¶¨ Ï§ë...',
                    valid: 'Ïú†Ìö®',
                    invalid: 'Î¨¥Ìö®',
                    all: 'Î™®Îëê',
                    noData: 'Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§',
                    stats: {
                        total: 'Ï¥ù Î†àÏΩîÎìú Ïàò',
                        matched: 'ÏùºÏπò',
                        unmatched: 'Î∂àÏùºÏπò',
                        diffAmount: 'Ï¥ù Ï∞®Ïï°',
                        notTaken: 'Ï∑®ÌïòÏßÄ ÏïäÏùå',
                        otherSvc: 'Î∞∞ÏÜ°Î£å',
                        adjustedTotalDiff: 'Î∞∞ÏÜ°Î£å Ï∞®Ïù¥',
                        duplicates: 'Ï§ëÎ≥µ'
                    },
                    table: {
                        billcode: 'Îπå ÏΩîÎìú',
                        amount1: 'ÌååÏùº 1 Í∏àÏï°',
                        amount2: 'ÌååÏùº 2 Í∏àÏï°',
                        difference: 'Ï∞®Ïï°',
                        status: 'ÏÉÅÌÉú',
                        reason: 'Ïù¥Ïú†',
                        other_svc_ttl: 'Î∞∞ÏÜ°Î£å',
                        otherSvc: 'Î∞∞ÏÜ°Î£å',
                        property: 'ÏÜçÏÑ±',
                        details: 'ÏÉÅÏÑ∏ Ï†ïÎ≥¥',
                        file1Count: 'ÌååÏùº 1 Îì±Ïû• ÌöüÏàò',
                        file2Count: 'ÌååÏùº 2 Îì±Ïû• ÌöüÏàò'
                    },
                    filter: {
                        validity: 'Ïú†Ìö®ÏÑ±',
                        billcodeSearch: 'Îπå ÏΩîÎìú Í≤ÄÏÉâ',
                        diffFilter: 'ÏµúÏÜå Ï∞®Ïï°',
                        clearFilters: 'ÌïÑÌÑ∞ ÏßÄÏö∞Í∏∞',
                        filtersTitle: 'ÌïÑÌÑ∞'
                    },
                    accordion: {
                        missingInFile2: 'ÌååÏùº 1Ïóê ÏûàÏßÄÎßå ÌååÏùº 2Ïóê ÏóÜÎäî Îπå ÏΩîÎìú',
                        missingInFile1: 'ÌååÏùº 2Ïóê ÏûàÏßÄÎßå ÌååÏùº 1Ïóê ÏóÜÎäî Îπå ÏΩîÎìú',
                        valueDiffs: 'Í∞ÄÏπò Ï∞®Ïù¥Í∞Ä ÏûàÎäî Îπå ÏΩîÎìú',
                        duplicates: 'Ï§ëÎ≥µÎêú Ï≤≠Íµ¨ ÏΩîÎìú'
                    },
                    alert: {
                        success: 'ÏÑ±Í≥µ: %s',
                        error: 'Ïò§Î•ò: %s',
                        warning: 'Í≤ΩÍ≥†: %s',
                        info: 'Ï†ïÎ≥¥: %s'
                    },
                    fileInfo: {
                        size: 'ÌÅ¨Í∏∞',
                        data: 'Îç∞Ïù¥ÌÑ∞',
                        rows: 'Ìñâ',
                        columns: 'Ïó¥'
                    },
                    pagination: {
                        page: 'ÌéòÏù¥ÏßÄ'
                    }
                },
                ru: {
                    title: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ Excel',
                    subtitle: '–¢–æ—á–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–≤—É—Ö —Ñ–∞–π–ª–æ–≤ Excel/CSV',
                    file1Title: '–§–∞–π–ª 1: Excel POS Jollibee',
                    file2Title: '–§–∞–π–ª 2: Excel DLBH Bkav',
                    file1Desc: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞',
                    file2Desc: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞',
                    compare: '–°—Ä–∞–≤–Ω–∏—Ç—å',
                    export: '–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel',
                    refresh: '–û–±–Ω–æ–≤–∏—Ç—å',
                    saveTemplate: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω',
                    processing: '–û–±—Ä–∞–±–æ—Ç–∫–∞...',
                    valid: '–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π',
                    invalid: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π',
                    all: '–í—Å–µ',
                    noData: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö',
                    stats: {
                        total: '–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π',
                        matched: '–°–æ–≤–ø–∞–¥–µ–Ω–∏—è',
                        unmatched: '–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è',
                        diffAmount: '–û–±—â–∞—è —Ä–∞–∑–Ω–∏—Ü–∞',
                        notTaken: '–ù–µ –≤–∑—è—Ç–æ',
                        otherSvc: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',
                        adjustedTotalDiff: '–†–∞–∑–Ω–∏—Ü–∞ –≤ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏',
                        duplicates: '–î—É–±–ª–∏–∫–∞—Ç'
                    },
                    table: {
                        billcode: '–ö–æ–¥ —Å—á–µ—Ç–∞',
                        amount1: '–°—É–º–º–∞ —Ñ–∞–π–ª–∞ 1',
                        amount2: '–°—É–º–º–∞ —Ñ–∞–π–ª–∞ 2',
                        difference: '–†–∞–∑–Ω–∏—Ü–∞',
                        status: '–°—Ç–∞—Ç—É—Å',
                        reason: '–ü—Ä–∏—á–∏–Ω–∞',
                        other_svc_ttl: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',
                        otherSvc: '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',
                        property: '–°–≤–æ–π—Å—Ç–≤–æ',
                        details: '–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏',
                        file1Count: '–ö–æ–ª-–≤–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–π –≤ —Ñ–∞–π–ª–µ 1',
                        file2Count:  '–ö–æ–ª-–≤–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–π –≤ —Ñ–∞–π–ª–µ 2'
                    },
                    filter: {
                        validity: '–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å',
                        billcodeSearch: '–ü–æ–∏—Å–∫ –∫–æ–¥–∞ —Å—á–µ—Ç–∞',
                        diffFilter: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞',
                        clearFilters: '–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã',
                        filtersTitle: '–§–∏–ª—å—Ç—Ä'
                    },
                    accordion: {
                        missingInFile2: '–ö–æ–¥—ã —Å—á–µ—Ç–æ–≤, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ —Ñ–∞–π–ª–µ 1, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ —Ñ–∞–π–ª–µ 2',
                        missingInFile1: '–ö–æ–¥—ã —Å—á–µ—Ç–æ–≤, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ —Ñ–∞–π–ª–µ 2, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ —Ñ–∞–π–ª–µ 1',
                        valueDiffs: '–ö–æ–¥—ã —Å—á–µ—Ç–æ–≤ —Å —Ä–∞–∑–ª–∏—á–∏—è–º–∏ –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö',
                        duplicates: '–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∫–æ–¥—ã —Å—á–µ—Ç–æ–≤'
                    },
                    alert: {
                        success: '–£—Å–ø–µ—Ö: %s',
                        error: '–û—à–∏–±–∫–∞: %s',
                        warning: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: %s',
                        info: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: %s'
                    },
                  fileInfo: {
                        size: '–†–∞–∑–º–µ—Ä',
                        data: '–î–∞–Ω–Ω—ã–µ',
                        rows: '—Å—Ç—Ä–æ–∫',
                        columns: '—Å—Ç–æ–ª–±—Ü–æ–≤'
                    },
                    pagination: {
                        page: '–°—Ç—Ä–∞–Ω–∏—Ü–∞'
                    }
                }
            };

        class ExcelCompareApp {
            constructor() {
                this.data1 = null;
                this.data2 = null;
                this.results = null;
                this.chartInstance = null;
                this.currentLang = localStorage.getItem('lang') || 'vi';
                this.theme = localStorage.getItem('theme') || 'light';
                this.filters = {
                    validity: 'all',
                    billcode: '',
                    minDiff: 0
                };
                this.pagination = {};
            }

            init() {
                this.setLanguage(this.currentLang);
                this.setTheme(this.theme);
                this.setupEventListeners();
                this.setupDragAndDrop();
                this.setupEvents();
                this.loadSavedData();
            }

            setupEventListeners() {
                const file1Input = document.getElementById('file1');
                const file2Input = document.getElementById('file2');
                const selectFile1Btn = document.getElementById('selectFile1Btn');
                const selectFile2Btn = document.getElementById('selectFile2Btn');
                const compareBtn = document.getElementById('compareBtn');
                const exportBtn = document.getElementById('exportBtn');
                const refreshBtn = document.getElementById('refreshBtn');
                const saveTemplateBtn = document.getElementById('saveTemplateBtn');
                const themeToggleBtn = document.getElementById('themeToggleBtn');
                const helpBtn = document.getElementById('helpBtn');
                const langSelect = document.getElementById('langSelect');
                const validityFilter = document.getElementById('validityFilter');
                const clearFiltersBtn = document.getElementById('clearFiltersBtn');

                if (file1Input) file1Input.addEventListener('change', (e) => this.handleFileSelect(e, 'file1'));
                if (file2Input) file2Input.addEventListener('change', (e) => this.handleFileSelect(e, 'file2'));
                if (selectFile1Btn) selectFile1Btn.addEventListener('click', () => document.getElementById('file1').click());
                if (selectFile2Btn) selectFile2Btn.addEventListener('click', () => document.getElementById('file2').click());
                if (compareBtn) compareBtn.addEventListener('click', () => this.compareFiles());
                if (exportBtn) exportBtn.addEventListener('click', () => this.exportToExcel());
                if (refreshBtn) refreshBtn.addEventListener('click', () => this.refreshPage());
                if (saveTemplateBtn) saveTemplateBtn.addEventListener('click', () => this.saveTemplate());
                if (themeToggleBtn) themeToggleBtn.addEventListener('click', () => this.toggleTheme());
                if (helpBtn) helpBtn.addEventListener('click', () => this.showHelp());
                if (langSelect) langSelect.addEventListener('change', (e) => this.setLanguage(e.target.value));
                if (validityFilter) validityFilter.addEventListener('change', () => this.applyFilters());
                if (clearFiltersBtn) clearFiltersBtn.addEventListener('click', () => this.clearFilters());

                window.addEventListener('beforeunload', (e) => {
                    if (this.data1 || this.data2) {
                        e.preventDefault();
                        e.returnValue = translations[this.currentLang]?.alert?.warning?.replace('%s', 'D·ªØ li·ªáu s·∫Ω b·ªã m·∫•t n·∫øu r·ªùi trang.') || 'Data will be lost if you leave the page.';
                    }
                });

                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey) {
                        switch(e.key) {
                            case 'r':
                                e.preventDefault();
                                this.compareFiles();
                                break;
                            case 's':
                                e.preventDefault();
                                this.exportToExcel();
                                break;
                            case 'n':
                                e.preventDefault();
                                this.refreshPage();
                                break;
                        }
                    }
                });
            }

            setupDragAndDrop() {
                ['uploadBox1', 'uploadBox2'].forEach(id => {
                    const box = document.getElementById(id);
                    if (!box) return;
                    const fileInput = id === 'uploadBox1' ? 'file1' : 'file2';
                    
                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        box.addEventListener(eventName, (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                        });
                    });

                    ['dragenter', 'dragover'].forEach(eventName => {
                        box.addEventListener(eventName, () => box.classList.add('dragover'));
                    });

                    ['dragleave', 'drop'].forEach(eventName => {
                        box.addEventListener(eventName, () => box.classList.remove('dragover'));
                    });

                    box.addEventListener('drop', (e) => {
                        const files = e.dataTransfer.files;
                        if (files.length > 0) {
                            const input = document.getElementById(fileInput);
                            if (input) {
                                input.files = files;
                                this.handleFileSelect({ target: { files } }, fileInput);
                            }
                        }
                    });
                });
            }
            async handleFileSelect(event, fileId) {
                const file = event.target.files[0];
                if (!file) return;

                const progressId = fileId === 'file1' ? 'progress1' : 'progress2';
                const infoId = fileId === 'file1' ? 'file1Info' : 'file2Info';
                
                this.showProgress(progressId, 0);
                
                try {
                    await this.validateFile(file);
                    this.showProgress(progressId, 30);
                    
                    const data = await this.processFile(file);
                    this.showProgress(progressId, 70);

                    // Ki·ªÉm tra tr√πng l·∫∑p
                    const billcodeCol = fileId === 'file1' ? 'chk_num' : 'M√£ bill';
                    const billcodeCounts = {};
                    data.forEach(row => {
                        const billcode = String(row[billcodeCol]).trim();
                        billcodeCounts[billcode] = (billcodeCounts[billcode] || 0) + 1;
                    });
                    const duplicates = Object.entries(billcodeCounts).filter(([_, count]) => count > 1);
                    if (duplicates.length > 0) {
                        this.showAlert('warning', translations[this.currentLang]?.alert?.warning?.replace('%s', `Ph√°t hi·ªán ${duplicates.length} Billcode tr√πng l·∫∑p trong ${fileId === 'file1' ? 'File 1' : 'File 2'}`) || `Detected ${duplicates.length} duplicate Billcodes in ${fileId === 'file1' ? 'File 1' : 'File 2'}`);
                    }
                    
                    if (fileId === 'file1') {
                        this.data1 = { file, data };
                    } else {
                        this.data2 = { file, data };
                    }
                    
                    this.updateFileInfo(infoId, file, data);
                    this.showProgress(progressId, 100);
                    setTimeout(() => this.hideProgress(progressId), 1000);
                    this.updateCompareButton();
                } catch (error) {
                    this.showAlert('danger', translations[this.currentLang]?.alert?.error?.replace('%s', error.message) || `Error: ${error.message}`);
                    this.hideProgress(progressId);
                }
            }

            async validateFile(file) {
                if (file.size > 50 * 1024 * 1024) {
                    throw new Error('File qu√° l·ªõn (t·ªëi ƒëa 50MB)');
                }

                const validTypes = [
                    'application/vnd.ms-excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'text/csv'
                ];
                
                if (!validTypes.includes(file.type) && !file.name.match(/\.(xlsx?|csv)$/i)) {
                    throw new Error('ƒê·ªãnh d·∫°ng file kh√¥ng h·ª£p l·ªá');
                }

                if (file.name.endsWith('.xlsm')) {
                    throw new Error('File ch·ª©a macro (.xlsm) kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£ do l·ªói b·∫£o m·∫≠t.');
                }

                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve();
                    reader.onerror = () => reject(new Error('Kh√¥ng th·ªÉ ƒë·ªçc file'));
                    reader.readAsArrayBuffer(file.slice(0, 1024));
                });
            }

            async processFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = async (event) => {
                        try {
                            let data;
                            if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
                                const text = new TextDecoder().decode(event.target.result);
                                const result = Papa.parse(text, {
                                    header: true,
                                    skipEmptyLines: true,
                                    dynamicTyping: true,
                                    encoding: 'UTF-8'
                                });
                                data = result.data;
                            } else {
                                const workbook = XLSX.read(event.target.result, {
                                    type: 'array',
                                    cellDates: true,
                                    cellNF: false,
                                    cellText: false
                                });
                                const sheetName = workbook.SheetNames[0];
                                data = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {
                                    header: true,
                                    raw: false,
                                    defval: null
                                });
                            }
                            
                            if (!data || data.length === 0) {
                                throw new Error(translations[this.currentLang]?.alert?.error?.replace('%s', 'File r·ªóng ho·∫∑c kh√¥ng c√≥ d·ªØ li·ªáu') || 'File is empty or contains no data');
                            }
                            
                            resolve(data);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = () => reject(new Error(translations[this.currentLang]?.alert?.error?.replace('%s', 'L·ªói ƒë·ªçc file') || 'Error reading file'));
                    reader.readAsArrayBuffer(file);
                });
            }

            updateFileInfo(infoId, file, data) {
                const info = document.getElementById(infoId);
                if (!info) return;
                const rows = data.length;
                const cols = Object.keys(data[0] || {}).length;
                const size = this.formatFileSize(file.size);
                
                info.innerHTML = `
                    <div><strong>${file.name}</strong></div>
                    <div>${translations[this.currentLang]?.alert?.success?.replace('%s', `${translations[this.currentLang]?.fileInfo?.size || 'Size'}: ${size}`)}</div>
                    <div>${translations[this.currentLang]?.alert?.success?.replace('%s', `${translations[this.currentLang]?.fileInfo?.data || 'Data'}: ${rows} ${translations[this.currentLang]?.fileInfo?.rows || 'rows'} √ó ${cols} ${translations[this.currentLang]?.fileInfo?.columns || 'columns'}`)}</div>
                    <div class="badge badge-success">‚úì ${translations[this.currentLang]?.valid || 'Valid'}</div>
                `;
                info.style.display = 'block';
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            showProgress(progressId, percentage) {
                const progressBar = document.getElementById(progressId);
                if (progressBar) {
                    const progress = progressBar.querySelector('.progress');
                    progressBar.style.display = 'block';
                    progress.style.width = `${percentage}%`;
                }
            }

            hideProgress(progressId) {
                const progressBar = document.getElementById(progressId);
                if (progressBar) {
                    progressBar.style.display = 'none';
                }
            }

            updateCompareButton() {
                const compareBtn = document.getElementById('compareBtn');
                if (compareBtn) {
                    compareBtn.disabled = !(this.data1 && this.data2);
                }
            }

            showAlert(type, message) {
                const content = document.querySelector('.content');
                if (!content) return;
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.textContent = message;
                content.prepend(alertDiv);
                setTimeout(() => alertDiv.remove(), 5000);
            }

            async compareFiles() {
                if (!this.data1 || !this.data2) {
                    this.showAlert('warning', translations[this.currentLang]?.alert?.warning?.replace('%s', 'Vui l√≤ng t·∫£i c·∫£ hai file') || 'Please upload both files');
                    return;
                }

                const loading = document.getElementById('loading');
                if (loading) loading.style.display = 'flex';
                
                try {
                    this.results = this.compareData(this.data1.data, this.data2.data);
                    this.renderResults();
                    this.renderChart();
                    const exportBtn = document.getElementById('exportBtn');
                    if (exportBtn) exportBtn.disabled = false;
                    const resultsDiv = document.getElementById('results');
                    if (resultsDiv) resultsDiv.style.display = 'block';
                    this.showAlert('success', translations[this.currentLang]?.alert?.success?.replace('%s', 'So s√°nh ho√†n t·∫•t') || 'Comparison completed');
                    this.renderChart(); // Th√™m d√≤ng n√†y
                } catch (error) {
                    this.showAlert('danger', translations[this.currentLang]?.alert?.error?.replace('%s', error.message) || `Error: ${error.message}`);
                } finally {
                    if (loading) loading.style.display = 'none';
                }
              }
            compareData(data1, data2) {
                if (!data1 || !data2 || !Array.isArray(data1) || !Array.isArray(data2) || data1.length === 0 || data2.length === 0) {
                    throw new Error('D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá ho·∫∑c r·ªóng');
                }

                const defaultHeaders1 = [
                    "chk_seq", "emp_seq", "trans_type_seq", "id", "chk_num", "chk_open", "tbl_seq", "grp", "rvc_seq",
                    "chk_open_date_time", "chk_clsd_date_time", "tbl_open_date_time", "subttl_date_time", "drawer_time",
                    "pc_seq", "standalone_check", "summ_ttl_prntd", "fast_trans_chk", "chk_cancelled", "chk_edited",
                    "training", "xfer_chk_num", "sub_ttl", "tax_ttl", "auto_svc_ttl", "other_svc_ttl", "pymnt_ttl",
                    "amt_due_ttl", "chk_prntd_cnt", "pg_num", "line_find_line_num", "cov_cnt", "status", "last_pc_seq",
                    "last_svc_time", "remark", "custid", "riderid", "outtime", "intime", "emplname", "deltime",
                    "memberid", "bpoint", "undeliveryremark", "misc", "seatprinted", "seatpaid", "memcard", "cc_id",
                    "survey_code", "survey_code_generate", "survey_prt_str", "survey_voucher_code", "sc_cnt", "MYEG_RefID"
                ];

                const defaultHeaders2 = [
                    "STT", "M√£ bill", "M√£ CH", "T√™n CH", "Ng√†y b√°n", "Ti·ªÅn tr∆∞·ªõc thu·∫ø", "Ti·ªÅn thu·∫ø", "Th√†nh ti·ªÅn",
                    "S·ªë h√≥a ƒë∆°n", "Tr·∫°ng th√°i", "Ghi ch√∫"
                ];

                const hasHeaders1 = data1.length > 0 && data1[0] && Object.keys(data1[0]).some(key => key.match(/chk_num|sub_ttl/i));
                const hasHeaders2 = data2.length > 0 && data2[0] && Object.keys(data2[0]).some(key => key.match(/M√£ bill|Th√†nh ti·ªÅn/i));

                const headers1 = hasHeaders1 ? Object.keys(data1[0]) : defaultHeaders1.slice(0, Object.keys(data1[0] || {}).length);
                const headers2 = hasHeaders2 ? Object.keys(data2[0]) : defaultHeaders2.slice(0, Object.keys(data2[0] || {}).length);

                const findColumnIndex = (headers, columnName) => {
                    const index = headers.findIndex(header => header && header.toString().trim().toLowerCase() === columnName.toLowerCase());
                    return index >= 0 ? headers[index] : columnName;
                };

                const billcodeCol1 = findColumnIndex(headers1, 'chk_num');
                const valueCol1 = findColumnIndex(headers1, 'sub_ttl');
                const otherSvcCol = findColumnIndex(headers1, 'other_svc_ttl');
                const conditionCols1 = {
                    standaloneCheck: findColumnIndex(headers1, 'standalone_check'),
                    summTtlPrntd: findColumnIndex(headers1, 'summ_ttl_prntd'),
                    fastTransChk: findColumnIndex(headers1, 'fast_trans_chk'),
                    chkCancelled: findColumnIndex(headers1, 'chk_cancelled'),
                    chkEdited: findColumnIndex(headers1, 'chk_edited'),
                    training: findColumnIndex(headers1, 'training')
                };

                const billcodeCol2 = findColumnIndex(headers2, 'M√£ bill');
                const valueCol2 = findColumnIndex(headers2, 'Th√†nh ti·ªÅn');
                const conditionCols2 = {
                    status: findColumnIndex(headers2, 'Tr·∫°ng th√°i')
                };

                if (!headers1.includes(billcodeCol1) || !headers1.includes(valueCol1)) {
                    throw new Error('File 1 thi·∫øu c·ªôt chk_num ho·∫∑c sub_ttl');
                }
                if (!headers2.includes(billcodeCol2) || !headers2.includes(valueCol2)) {
                    throw new Error('File 2 thi·∫øu c·ªôt M√£ bill ho·∫∑c Th√†nh ti·ªÅn');
                }

                const groupByBillcode = (data, billcodeCol) => {
                    const grouped = {};
                    data.forEach((row, index) => {
                        const billcode = String(row[billcodeCol]).trim().toLowerCase();
                        if (!billcode) return;
                        if (!grouped[billcode]) grouped[billcode] = [];
                        grouped[billcode].push({ ...row, originalIndex: index + 2 });
                    });
                    return grouped;
                };

                const groupedData1 = groupByBillcode(data1, billcodeCol1);
                const groupedData2 = groupByBillcode(data2, billcodeCol2);

                // Khai b√°o excludedBills cho c·∫£ File 1 v√† File 2
                const excludedBills1 = [];
                const excludedBills2 = [];

                // ƒêi·ªÅu ki·ªán b·ªè qua cho File 1
                const validRows1 = (Array.isArray(data1) ? data1 : []).filter(row => {
                    const reasons = [];
                    const billcode = String(row[billcodeCol1]).trim();
                    const subTtl = parseFloat(row[valueCol1]) || 0;
                    const conditions = [
                        { col: conditionCols1.standaloneCheck, name: 'standalone_check' },
                        { col: conditionCols1.summTtlPrntd, name: 'summ_ttl_prntd' },
                        { col: conditionCols1.fastTransChk, name: 'fast_trans_chk' },
                        { col: conditionCols1.chkCancelled, name: 'chk_cancelled' },
                        { col: conditionCols1.chkEdited, name: 'chk_edited' },
                        { col: conditionCols1.training, name: 'training' }
                    ];

                    conditions.forEach(({ col, name }) => {
                        if (row[col] != null) {
                            const val = parseInt(row[col], 10);
                            if (!isNaN(val) && (val === 1 || val === -1)) {
                                reasons.push(`${name} = ${val}`);
                            }
                        }
                    });

                    if (subTtl < 0) {
                        reasons.push(`sub_ttl < 0 (${subTtl.toFixed(2)})`);
                    }
                    if (subTtl === 0) {
                        const hasInFile2 = groupedData2[billcode] && groupedData2[billcode].length > 0;
                        if (!hasInFile2) {
                            reasons.push(`sub_ttl = 0`);
                        }
                    }

                    if (reasons.length > 0) {
                        excludedBills1.push({ billcode, reason: reasons.join(', ') });
                        return false;
                    }
                    return true;
                });
                data2.forEach(row => {
                    const billcode = String(row[billcodeCol2]).trim().toLowerCase();
                    if (row[conditionCols2.status] && String(row[conditionCols2.status]).toLowerCase() === 'h·ªßy') {
                        excludedBills2.push({ billcode, reason: 'Tr·∫°ng th√°i = H·ªßy', status: 'valid' });
                    }
                });

                let notTakenCount = excludedBills1.length + excludedBills2.length;

                // B∆∞·ªõc 1: Ki·ªÉm tra billcode c√≥ ·ªü File 1 nh∆∞ng kh√¥ng ·ªü File 2
                const missingInFile2 = [];
                Object.keys(groupedData1).forEach(billcode => {
                    const rows1 = groupedData1[billcode];
                    const rows2 = groupedData2[billcode] || [];
                    const count2 = rows2.length;

                    if (count2 === 0) {
                        rows1.forEach(row => {
                            const excluded = excludedBills1.find(e => e.billcode === billcode);
                            if (excluded) {
                                missingInFile2.push({ billcode, reason: excluded.reason, status: 'valid' });
                            } else {
                                missingInFile2.push({ billcode, reason: 'Kh√¥ng c√≥ trong File 2', status: 'invalid' });
                            }
                        });
                    }
                });

                // B∆∞·ªõc 2: Ki·ªÉm tra billcode c√≥ ·ªü File 2 nh∆∞ng kh√¥ng ·ªü File 1
                const missingInFile1 = [];
                Object.keys(groupedData2).forEach(billcode => {
                    const rows1 = groupedData1[billcode] || [];
                    const rows2 = groupedData2[billcode];
                    const count1 = rows1.length;

                    if (count1 === 0) {
                        rows2.forEach(row => {
                            const excluded = excludedBills2.find(e => e.billcode === billcode);
                            if (excluded) {
                                missingInFile1.push({ billcode, reason: excluded.reason, status: 'valid' });
                            } else {
                                missingInFile1.push({ billcode, reason: 'Kh√¥ng c√≥ trong File 1', status: 'invalid' });
                            }
                        });
                    }
                });

                // B∆∞·ªõc 3: So s√°nh gi√° tr·ªã ch√™nh l·ªách v√† x·ª≠ l√Ω tr√πng l·∫∑p
                const valueDiffs = [];
                const duplicateBillcodes = [];
                let totalDiff = 0;
                let matched = 0;
                let unmatched = 0;
                let totalOtherSvc = 0;
                let adjustedTotalDiff = 0;

                const billcodes = new Set([...Object.keys(groupedData1), ...Object.keys(groupedData2)]);
                billcodes.forEach(billcode => {
                    const rows1 = groupedData1[billcode] || [];
                    const rows2 = groupedData2[billcode] || [];
                    const count1 = rows1.length;
                    const count2 = rows2.length;

                    if (count1 > 0 && count2 > 0) {
                        const totalVal1 = rows1.reduce((sum, row) => sum + (parseFloat(row[valueCol1]) || 0) + (parseFloat(row[otherSvcCol]) || 0), 0);
                        const totalVal2 = rows2.reduce((sum, row) => sum + (parseFloat(row[valueCol2]) || 0), 0);
                        const diff = Math.abs(totalVal2 - totalVal1);

                        // Ki·ªÉm tra sub_ttl = 0 ƒë·ªÉ so s√°nh
                        const hasSubTtlZero = rows1.some(row => parseFloat(row[valueCol1]) === 0);
                        if (hasSubTtlZero || !(rows1.some(row => excludedBills1.find(e => e.billcode === billcode)))) {
                            if (diff > 0.01) {
                                valueDiffs.push({
                                    billcode,
                                    amount1: totalVal1,
                                    amount2: totalVal2,
                                    difference: totalVal2 - totalVal1,
                                    status: 'invalid',
                                    otherSvc: rows1.reduce((sum, row) => sum + (parseFloat(row[otherSvcCol]) || 0), 0)
                                });
                                unmatched++;
                                totalDiff += diff;
                            } else {
                                valueDiffs.push({
                                    billcode,
                                    amount1: totalVal1,
                                    amount2: totalVal2,
                                    difference: totalVal2 - totalVal1,
                                    status: 'valid',
                                    otherSvc: rows1.reduce((sum, row) => sum + (parseFloat(row[otherSvcCol]) || 0), 0)
                                });
                                matched++;
                            }
                        }

                        // X·ª≠ l√Ω tr√πng l·∫∑p
                        if (count1 > 1 || count2 > 1) {
                            const positionsFile1 = rows1.map(row => row.originalIndex || '?');
                            const positionsFile2 = rows2.map(row => row.originalIndex || '?');

                            duplicateBillcodes.push({
                                billcode,
                                file1Count: count1,
                                file2Count: count2,
                                details: `File 1: ${count1} (Rows: ${positionsFile1.join(', ')}), File 2: ${count2} (Rows: ${positionsFile2.join(', ')})`,
                                validStatus: count1 === count2 ? 'valid' : 'invalid',
                                difference: diff,
                                positionsFile1,
                                positionsFile2
                            });
                        }
                        totalOtherSvc += rows1.reduce((sum, row) => sum + (parseFloat(row[otherSvcCol]) || 0), 0);
                        adjustedTotalDiff += diff;
                    }
                });

                // T√≠nh t·ªïng s·ªë b·∫£n ghi
                const totalRecords = data1.length + data2.length; // T·ªïng s·ªë b·∫£n ghi t·ª´ c·∫£ hai file
                const uniqueBillcodes = new Set([...Object.keys(groupedData1), ...Object.keys(groupedData2)]).size;
                const overlappingBillcodes = Object.keys(groupedData1).filter(billcode => groupedData2[billcode]).length;
                const adjustedTotal = totalRecords - overlappingBillcodes + (overlappingBillcodes * 2); // ƒêi·ªÅu ch·ªânh ƒë·ªÉ m·ªói c·∫∑p tr√πng l√† 2 b·∫£n ghi

                return {
                    data: {
                        missingInFile2,
                        missingInFile1,
                        valueDiffs,
                        duplicateBillcodes
                    },
                    stats: {
                        total: data1.length + data2.length,           // T·ªïng s·ªë h√†ng
                        matched,                                      // S·ªë c·∫∑p kh·ªõp
                        matchedRows: matched * 2,                     // S·ªë h√†ng kh·ªõp
                        unmatched,                                    // S·ªë c·∫∑p l·ªách
                        unmatchedRows: unmatched * 2,                 // S·ªë h√†ng l·ªách
                        notTaken: notTakenCount,                      // S·ªë h√†ng b·ªã lo·∫°i
                        remainingRows: (data1.length + data2.length) - (matched * 2), // Ph·∫ßn ch∆∞a kh·ªõp
                        totalDiff: totalDiff.toFixed(2),
                        totalOtherSvc: totalOtherSvc.toFixed(2),
                        adjustedTotalDiff: adjustedTotalDiff.toFixed(2),
                        duplicates: duplicateBillcodes.length
                    }
                };
            }
            renderResults() {
                if (!this.results) {
                    console.log('No results to render');
                    return;
                }
                const { data, stats } = this.results;
                this.renderStats(stats);
                this.renderTables(data);
                this.setupAccordionEvents();
                this.setupPaginationEvents();
            }
             renderTables(data) {
                const filteredData = this.applyFiltersToData(data);
                const accordion = document.getElementById('resultsAccordion');
                if (!accordion) return;

                const billcodeCounts1 = {};
                this.data1.data.forEach(row => {
                    const billcode = String(row['chk_num']).trim();
                    billcodeCounts1[billcode] = (billcodeCounts1[billcode] || 0) + 1;
                });
                const billcodeCounts2 = {};
                this.data2.data.forEach(row => {
                    const billcode = String(row['M√£ bill']).trim();
                    billcodeCounts2[billcode] = (billcodeCounts2[billcode] || 0) + 1;
                });

                const getSTT = (index, tableId) => {
                    const page = this.pagination[tableId]?.currentPage || 1;
                    const itemsPerPage = this.pagination[tableId]?.itemsPerPage || 20;
                    return (page - 1) * itemsPerPage + index + 1;
                };

                // C·∫≠p nh·∫≠t "Ch√™nh l·ªách t·ªïng" trong giao di·ªán
                const totalDiffElement = document.getElementById('totalDiff');
                if (totalDiffElement) {
                    totalDiffElement.textContent = data.stats.totalDiff || '0.00';
                }

                accordion.innerHTML = `
                    <div class="accordion-item">
                        <div class="accordion-header">
                            ${translations[this.currentLang]?.accordion?.missingInFile2 || 'Missing in File 2'}
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>STT</th>
                                            <th>${translations[this.currentLang]?.table?.billcode || 'Billcode'}</th>
                                            <th>${translations[this.currentLang]?.table?.reason || 'Reason'}</th>
                                            <th>${translations[this.currentLang]?.table?.status || 'Status'}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filteredData.missingInFile2.length > 0 ? this.paginateData(filteredData.missingInFile2, 'missingInFile2').map((row, index) => `
                                            <tr>
                                                <td>${getSTT(index, 'missingInFile2')}</td>
                                                <td>${row.billcode || '-'}</td>
                                                <td>${row.reason || '-'}</td>
                                                <td><span class="${row.status === 'valid' ? 'badge badge-success' : 'badge badge-danger'}">
                                                    ${translations[this.currentLang]?.[row.status] || row.status}
                                                </span></td>
                                            </tr>
                                        `).join('') : `<tr><td colspan="4">${translations[this.currentLang]?.noData || 'No data'}</td></tr>`}
                                    </tbody>
                                </table>
                                ${this.renderPagination(filteredData.missingInFile2, 'missingInFile2')}
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            ${translations[this.currentLang]?.accordion?.missingInFile1 || 'Missing in File 1'}
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>STT</th>
                                            <th>${translations[this.currentLang]?.table?.billcode || 'Billcode'}</th>
                                            <th>${translations[this.currentLang]?.table?.reason || 'Reason'}</th>
                                            <th>${translations[this.currentLang]?.table?.status || 'Status'}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filteredData.missingInFile1.length > 0 ? this.paginateData(filteredData.missingInFile1, 'missingInFile1').map((row, index) => `
                                            <tr>
                                                <td>${getSTT(index, 'missingInFile1')}</td>
                                                <td>${row.billcode || '-'}</td>
                                                <td>${row.reason || '-'}</td>
                                                <td><span class="${row.status === 'valid' ? 'badge badge-success' : 'badge badge-danger'}">
                                                    ${translations[this.currentLang]?.[row.status] || row.status}
                                                </span></td>
                                            </tr>
                                        `).join('') : `<tr><td colspan="4">${translations[this.currentLang]?.noData || 'No data'}</td></tr>`}
                                    </tbody>
                                </table>
                                ${this.renderPagination(filteredData.missingInFile1, 'missingInFile1')}
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            ${translations[this.currentLang]?.accordion?.valueDiffs || 'Value Differences'}
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>STT</th>
                                            <th>${translations[this.currentLang]?.table?.billcode || 'Billcode'}</th>
                                            <th>${translations[this.currentLang]?.table?.amount1 || 'Amount 1'}</th>
                                            <th>${translations[this.currentLang]?.table?.amount2 || 'Amount 2'}</th>
                                            <th>${translations[this.currentLang]?.table?.difference || 'Difference'}</th>
                                            <th>${translations[this.currentLang]?.table?.status || 'Status'}</th>
                                            <th>${translations[this.currentLang]?.table?.otherSvc || 'Other Service'}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filteredData.valueDiffs.length > 0 ? this.paginateData(filteredData.valueDiffs, 'valueDiffs').map((row, index) => `
                                            <tr>
                                                <td>${getSTT(index, 'valueDiffs')}</td>
                                                <td>${row.billcode || '-'}</td>
                                                <td>${row.amount1 !== undefined ? row.amount1.toFixed(2) : '0.00'}</td>
                                                <td>${row.amount2 !== undefined ? row.amount2.toFixed(2) : '0.00'}</td>
                                                <td>${row.difference !== undefined ? row.difference.toFixed(2) : '0.00'}</td>
                                                <td><span class="${row.status === 'valid' ? 'badge badge-success' : 'badge badge-danger'}">
                                                    ${translations[this.currentLang]?.[row.status] || row.status}
                                                </span></td>
                                                <td>${row.otherSvc !== undefined ? row.otherSvc.toFixed(2) : '0.00'}</td>
                                            </tr>
                                        `).join('') : `<tr><td colspan="4">${translations[this.currentLang]?.noData || 'No data'}</td></tr>`}
                                    </tbody>
                                </table>
                                ${this.renderPagination(filteredData.valueDiffs, 'valueDiffs')}
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item active">
                        <div class="accordion-header">
                            ${translations[this.currentLang]?.accordion?.duplicates || 'Duplicate Billcodes'}
                            <span class="accordion-icon">‚ñº</span>
                        </div>
                        <div class="accordion-content" style="display: block;">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>STT</th>
                                            <th>${translations[this.currentLang]?.table?.billcode || 'Billcode'}</th>
                                            <th>${translations[this.currentLang]?.table?.file1Count || 'File 1 Count'}</th>
                                            <th>${translations[this.currentLang]?.table?.file2Count || 'File 2 Count'}</th>
                                            <th>${translations[this.currentLang]?.table?.details || 'Details'}</th>
                                            <th>${translations[this.currentLang]?.table?.status || 'Valid Status'}</th>
                                            <th>${translations[this.currentLang]?.table?.difference || 'Difference'}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filteredData.duplicateBillcodes.length > 0 ? this.paginateData(filteredData.duplicateBillcodes, 'duplicates').map((row, index) => `
                                            <tr>
                                                <td>${getSTT(index, 'duplicates')}</td>
                                                <td>${row.billcode || '-'}</td>
                                                <td>${row.file1Count || 0}</td>
                                                <td>${row.file2Count || 0}</td>
                                                <td>${row.details || '-'}</td>
                                                <td><span class="${row.validStatus?.toLowerCase() === 'valid' ? 'badge badge-success' : 'badge badge-danger'}">
                                                    ${translations[this.currentLang]?.[row.validStatus?.toLowerCase()] || row.validStatus || '-'}
                                                </span></td>
                                                <td>${row.difference !== undefined ? this.formatNumber(row.difference) : '0.00'}</td>
                                            </tr>
                                        `).join('') : `<tr><td colspan="4">${translations[this.currentLang]?.noData || 'No data'}</td></tr>`}
                                    </tbody>
                                </table>
                                ${this.renderPagination(filteredData.duplicateBillcodes, 'duplicates')}
                            </div>
                        </div>
                    </div>
                `;

                this.renderBillcodeChart(filteredData.duplicateBillcodes);
            }

                            setupAccordionEvents() {
                const headers = document.querySelectorAll('.accordion-header');
                headers.forEach(header => {
                    header.addEventListener('click', () => {
                        const parent = header.parentElement;
                        parent.classList.toggle('active');
                    });
                });
            }

            setupPaginationEvents() {
                const buttons = document.querySelectorAll('.pagination button');
                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        const tableId = button.getAttribute('data-table-id');
                        const action = button.getAttribute('data-action');
                        if (tableId && action) {
                            if (action === 'prev') {
                                this.pagination[tableId].currentPage--;
                            } else if (action === 'next') {
                                this.pagination[tableId].currentPage++;
                            }
                            this.renderResults();
                            this.renderChart();
                        }
                    });
                });
            }

            renderStats(stats) {
                const statsGrid = document.getElementById('statsGrid');
                if (!statsGrid) return;

                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${stats.total}</div>
                        <div class="stat-label">${translations[this.currentLang]?.stats?.total || 'Total Records'}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.matched}</div>
                        <div class="stat-label">${translations[this.currentLang]?.stats?.matched || 'Matched'}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.unmatched}</div>
                        <div class="stat-label">${translations[this.currentLang]?.stats?.unmatched || 'Unmatched'}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.notTaken}</div>
                        <div class="stat-label">${translations[this.currentLang]?.stats?.notTaken || 'Not Taken'}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.duplicates}</div>
                        <div class="stat-label">${translations[this.currentLang]?.stats?.duplicates || 'Duplicate Billcodes'}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${parseFloat(stats.totalDiff).toLocaleString('vi-VN')}</div>
                        <div class="stat-label">${translations[this.currentLang]?.stats?.diffAmount || 'Total Difference'}</div>
                    </div>
                `;
            }
                formatNumber(value) {
        const num = parseFloat(value); // Chuy·ªÉn v·ªÅ s·ªë th·ª±c
        if (Number.isInteger(num)) {
            return num.toLocaleString('vi-VN'); // Hi·ªÉn th·ªã s·ªë nguy√™n v·ªõi ph√¢n c√°ch
        } else {
            return num.toLocaleString('vi-VN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); // Hi·ªÉn th·ªã 2 ch·ªØ s·ªë th·∫≠p ph√¢n n·∫øu c√≥
        }
    }
            applyFiltersToData(data) {
                const filtered = {
                    missingInFile2: data.missingInFile2.filter(row => {
                        const validityMatch = this.filters.validity === 'all' || 
                                            (this.filters.validity === 'invalid' && row.status === 'invalid') || 
                                            (this.filters.validity === 'valid' && row.status === 'valid');
                        const billcodeMatch = !this.filters.billcode || 
                                            (row.billcode && row.billcode.toString().toLowerCase().includes(this.filters.billcode.toLowerCase()));
                        return validityMatch && billcodeMatch;
                    }),
                    missingInFile1: data.missingInFile1.filter(row => {
                        const validityMatch = this.filters.validity === 'all' || 
                                            (this.filters.validity === 'invalid' && row.status === 'invalid') || 
                                            (this.filters.validity === 'valid' && row.status === 'valid');
                        const billcodeMatch = !this.filters.billcode || 
                                            (row.billcode && row.billcode.toString().toLowerCase().includes(this.filters.billcode.toLowerCase()));
                        return validityMatch && billcodeMatch;
                    }),
                    valueDiffs: data.valueDiffs.filter(row => {
                        const validityMatch = this.filters.validity === 'all' || 
                                            (this.filters.validity === 'invalid' && row.status === 'invalid') || 
                                            (this.filters.validity === 'valid' && row.status === 'valid');
                        const billcodeMatch = !this.filters.billcode || 
                                            (row.billcode && row.billcode.toString().toLowerCase().includes(this.filters.billcode.toLowerCase()));
                        const diffMatch = !this.filters.minDiff || Math.abs(row.difference || 0) >= this.filters.minDiff;
                        const notZeroDiff = Math.abs(row.difference || 0) !== 0;
                        return validityMatch && billcodeMatch && diffMatch && notZeroDiff;
                    }),
                    duplicateBillcodes: data.duplicateBillcodes.filter(row => {
                        const validityMatch = this.filters.validity === 'all' || 
                                            (this.filters.validity === 'invalid' && row.validStatus === 'Invalid') || 
                                            (this.filters.validity === 'valid' && row.validStatus === 'Valid');
                        const billcodeMatch = !this.filters.billcode || 
                                            (row.billcode && row.billcode.toString().toLowerCase().includes(this.filters.billcode.toLowerCase()));
                        const diffMatch = !this.filters.minDiff || Math.abs(row.difference || 0) >= this.filters.minDiff;
                        const notZeroDiff = Math.abs(row.difference || 0) !== 0;
                        return validityMatch && billcodeMatch && diffMatch && notZeroDiff;
                    })
                };

                return filtered;
            }
            paginateData(data, tableId) {
                if (!this.pagination[tableId]) {
                    this.pagination[tableId] = { currentPage: 1, itemsPerPage: 20 };
                }
                const start = (this.pagination[tableId].currentPage - 1) * this.pagination[tableId].itemsPerPage;
                const end = start + this.pagination[tableId].itemsPerPage;
                return data.slice(start, end);
            }
            renderPagination(data, tableId) {
                if (!this.pagination[tableId]) {
                    this.pagination[tableId] = { currentPage: 1, itemsPerPage: 20 };
                }
                const totalPages = data.length === 0 ? 0 : Math.ceil(data.length / this.pagination[tableId].itemsPerPage);
                // N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu, hi·ªÉn th·ªã 0/0 v√† v√¥ hi·ªáu h√≥a n√∫t
                if (totalPages === 0) {
                    return `
                        <div class="pagination">
                            <button data-table-id="${tableId}" data-action="prev" disabled>‚Üê</button>
                            <span>${translations[this.currentLang]?.pagination?.page || 'Page'} 0 / 0</span>
                            <button data-table-id="${tableId}" data-action="next" disabled>‚Üí</button>
                        </div>
                    `;
                }
                return `
                    <div class="pagination">
                        <button data-table-id="${tableId}" data-action="prev" 
                                ${this.pagination[tableId].currentPage === 1 ? 'disabled' : ''}>‚Üê</button>
                        <span>${translations[this.currentLang]?.pagination?.page || 'Page'} ${this.pagination[tableId].currentPage} / ${totalPages}</span>
                        <button data-table-id="${tableId}" data-action="next" 
                                ${this.pagination[tableId].currentPage === totalPages ? 'disabled' : ''}>‚Üí</button>
                    </div>
                `;
            }
            applyFilters() {
                const validityFilter = document.getElementById('validityFilter');
                const billcodeSearch = document.getElementById('billcodeSearch');
                const diffFilter = document.getElementById('diffFilter');
                if (validityFilter) {
                    this.filters.validity = validityFilter.value;
                    console.log('Updated validity filter:', this.filters.validity);
                }
                if (billcodeSearch) this.filters.billcode = billcodeSearch.value;
                if (diffFilter) this.filters.minDiff = parseFloat(diffFilter.value) || 0;
                Object.keys(this.pagination).forEach(tableId => {
                    this.pagination[tableId].currentPage = 1;
                });
                this.renderResults();
                this.renderChart();
            }

            clearFilters() {
                this.filters = { validity: 'all', billcode: '', minDiff: 0 };
                const validityFilter = document.getElementById('validityFilter');
                const billcodeSearch = document.getElementById('billcodeSearch');
                const diffFilter = document.getElementById('diffFilter');
                if (validityFilter) validityFilter.value = 'all';
                if (billcodeSearch) billcodeSearch.value = '';
                if (diffFilter) diffFilter.value = '';
                Object.keys(this.pagination).forEach(tableId => {
                    this.pagination[tableId].currentPage = 1;
                });
                // Only render results if this.results exists
                if (this.results) {
                    this.renderResults();
                    this.renderChart();
                }
            }
                        renderChart() {
                const canvas = document.getElementById('validityChart');
                if (!canvas || !this.results?.stats) return;

                const ctx = canvas.getContext('2d');

                // H·ªßy bi·ªÉu ƒë·ªì c≈© n·∫øu c√≥
                if (this.chartInstance) {
                    this.chartInstance.destroy();
                }

                const stats = this.results.stats;
                const lang = translations[this.currentLang];

                const matched = stats.matched || 0;
                const unmatched = stats.unmatched || 0;
                const duplicates = stats.duplicates || 0;
                const notTaken = stats.notTaken || 0;
                const total = stats.total || 0;

                const invalid = unmatched + duplicates + notTaken;

                this.chartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [
                            lang.stats?.matched || 'Matched',
                            lang.stats?.unmatched || 'Unmatched',
                            lang.stats?.duplicates || 'Duplicates',
                            lang.stats?.notTaken || 'Not Taken'
                        ],
                        datasets: [{
                            label: 'Comparison Summary',
                            data: [matched, unmatched, duplicates, notTaken],
                            backgroundColor: ['#28a745', '#dc3545', '#ffc107', '#17a2b8']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });

                // C·∫≠p nh·∫≠t ph·∫ßn chi ti·∫øt b√™n c·∫°nh bi·ªÉu ƒë·ªì
                const detail = document.getElementById('chartDetails');
                if (detail) {
                    detail.innerHTML = `
                        <ul>
                            <li><strong>${lang.stats?.matched || 'Matched'}:</strong> ${matched}</li>
                            <li><strong>${lang.stats?.unmatched || 'Unmatched'}:</strong> ${unmatched}</li>
                            <li><strong>${lang.stats?.duplicates || 'Duplicates'}:</strong> ${duplicates}</li>
                            <li><strong>${lang.stats?.notTaken || 'Not Taken'}:</strong> ${notTaken}</li>
                            <li><strong>${lang.stats?.total || 'Total'}:</strong> ${total}</li>
                        </ul>
                    `;
                }
            }

            exportToExcel() {
                if (!this.results) {
                    this.showAlert('warning', translations[this.currentLang]?.alert?.warning?.replace('%s', 'Ch∆∞a c√≥ k·∫øt qu·∫£ ƒë·ªÉ xu·∫•t') || 'No results to export');
                    return;
                }

                const billcodeCounts1 = {};
                this.data1.data.forEach(row => {
                    const billcode = String(row['chk_num']).trim();
                    billcodeCounts1[billcode] = (billcodeCounts1[billcode] || 0) + 1;
                });
                const billcodeCounts2 = {};
                this.data2.data.forEach(row => {
                    const billcode = String(row['M√£ bill']).trim();
                    billcodeCounts2[billcode] = (billcodeCounts2[billcode] || 0) + 1;
                });

                const wb = XLSX.utils.book_new();

                const ws1 = XLSX.utils.json_to_sheet(this.results.data.missingInFile2.map((row, index) => ({
                    STT: index + 1,
                    [translations[this.currentLang]?.table?.billcode || 'Billcode']: row.billcode,
                    [translations[this.currentLang]?.table?.occurrences || 'Occurrences']: billcodeCounts1[row.billcode] || 1,
                    'L√Ω do': row.reason,
                    [translations[this.currentLang]?.table?.status || 'Status']: translations[this.currentLang]?.[row.status] || row.status
                })));
                XLSX.utils.book_append_sheet(wb, ws1, 'Missing in File 2');

                const ws2 = XLSX.utils.json_to_sheet(this.results.data.missingInFile1.map((row, index) => ({
                    STT: index + 1,
                    [translations[this.currentLang]?.table?.billcode || 'Billcode']: row.billcode,
                    [translations[this.currentLang]?.table?.occurrences || 'Occurrences']: billcodeCounts2[row.billcode] || 1,
                    'L√Ω do': row.reason,
                    [translations[this.currentLang]?.table?.status || 'Status']: translations[this.currentLang]?.[row.status] || row.status
                })));
                XLSX.utils.book_append_sheet(wb, ws2, 'Missing in File 1');

                const ws3 = XLSX.utils.json_to_sheet(this.results.data.valueDiffs.map((row, index) => {
                    const occurrencesFile1Key = `${translations[this.currentLang]?.table?.occurrences || 'Occurrences'} (File 1)`;
                    const occurrencesFile2Key = `${translations[this.currentLang]?.table?.occurrences || 'Occurrences'} (File 2)`;
                    return {
                        STT: index + 1,
                        [translations[this.currentLang]?.table?.billcode || 'Billcode']: row.billcode,
                        [occurrencesFile1Key]: billcodeCounts1[row.billcode] || 1,
                        [occurrencesFile2Key]: billcodeCounts2[row.billcode] || 1,
                        [translations[this.currentLang]?.table?.amount1 || 'Amount File 1']: row.amount1 !== null ? row.amount1 : '-',
                        [translations[this.currentLang]?.table?.amount2 || 'Amount File 2']: row.amount2 !== null ? row.amount2 : '-',
                        [translations[this.currentLang]?.table?.difference || 'Difference']: row.difference,
                        [translations[this.currentLang]?.table?.status || 'Status']: translations[this.currentLang]?.[row.status] || row.status,
                        'other_svc_ttl': row.otherSvc !== null ? row.otherSvc : '-'
                    };
                }));
                XLSX.utils.book_append_sheet(wb, ws3, 'Value Differences');

                const ws4 = XLSX.utils.json_to_sheet(this.results.data.duplicateBillcodes.map((row, index) => ({
                    STT: index + 1,
                    [translations[this.currentLang]?.table?.billcode || 'Billcode']: row.billcode,
                    [translations[this.currentLang]?.table?.file1Count || 'File 1 Count']: row.file1Count,
                    [translations[this.currentLang]?.table?.file2Count || 'File 2 Count']: row.file2Count,
                    [translations[this.currentLang]?.table?.status || 'Status']: row.status,
                    [translations[this.currentLang]?.table?.details || 'Details']: row.details
                })));
                XLSX.utils.book_append_sheet(wb, ws4, 'Duplicate Billcodes');

                XLSX.writeFile(wb, 'comparison_results.xlsx');
                this.showAlert('success', translations[this.currentLang]?.alert?.success?.replace('%s', 'Xu·∫•t file Excel th√†nh c√¥ng') || 'Exported Excel successfully');
            }

            refreshPage() {
                this.data1 = null;
                this.data2 = null;
                this.results = null;
                if (this.chartInstance) {
                    this.chartInstance.destroy();
                    this.chartInstance = null;
                }
                const file1 = document.getElementById('file1');
                const file2 = document.getElementById('file2');
                if (file1) file1.value = '';
                if (file2) file2.value = '';
                const file1Info = document.getElementById('file1Info');
                const file2Info = document.getElementById('file2Info');
                if (file1Info) file1Info.style.display = 'none';
                if (file2Info) file2Info.style.display = 'none';
                const results = document.getElementById('results');
                if (results) results.style.display = 'none';
                const compareBtn = document.getElementById('compareBtn');
                const exportBtn = document.getElementById('exportBtn');
                if (compareBtn) compareBtn.disabled = true;
                if (exportBtn) exportBtn.disabled = true;
                this.clearFilters();
                localStorage.removeItem('excelCompareData');
                    localStorage.removeItem('savedData');
                    localStorage.removeItem('compareResults');
                this.showAlert('success', translations[this.currentLang]?.alert?.success?.replace('%s', 'ƒê√£ l√†m m·ªõi trang') || 'Page refreshed');
                 window.location.reload();
            }

            saveTemplate() {
                if (!this.results) {
                    this.showAlert('warning', translations[this.currentLang]?.alert?.warning?.replace('%s', 'Ch∆∞a c√≥ k·∫øt qu·∫£ ƒë·ªÉ l∆∞u m·∫´u') || 'No results to save as template');
                    return;
                }
                localStorage.setItem('excelCompareTemplate', JSON.stringify(this.results));
                this.showAlert('success', translations[this.currentLang]?.alert?.success?.replace('%s', 'ƒê√£ l∆∞u m·∫´u') || 'Template saved');
            }
            loadSavedData() {
                const savedData = localStorage.getItem('excelCompareData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    const file1Info = document.getElementById('file1Info');
                    const file2Info = document.getElementById('file2Info');
                    if (data.data1 && file1Info) {
                        file1Info.innerHTML = `<div><strong>${data.data1.name}</strong></div>`;
                        file1Info.style.display = 'block';
                    }
                    if (data.data2 && file2Info) {
                        file2Info.innerHTML = `<div><strong>${data.data2.name}</strong></div>`;
                        file2Info.style.display = 'block';
                    }
                }
            }
            setLanguage(lang) {
                if (!translations[lang]) {
                    console.warn(`Language ${lang} not found, falling back to 'vi'`);
                    lang = 'vi';
                }
                this.currentLang = lang;
                localStorage.setItem('lang', lang);
                const langSelect = document.getElementById('langSelect');
                if (langSelect) langSelect.value = lang;
                const title = document.getElementById('title');
                if (title) title.textContent = translations[lang]?.title || 'Excel File Comparison Tool';
                const subtitle = document.getElementById('subtitle');
                if (subtitle) subtitle.textContent = translations[lang]?.subtitle || 'Analyze and compare data from two Excel/CSV files';
                const file1Title = document.getElementById('file1Title');
                if (file1Title) file1Title.textContent = translations[lang]?.file1Title || 'File 1';
                const file2Title = document.getElementById('file2Title');
                if (file2Title) file2Title.textContent = translations[lang]?.file2Title || 'File 2';
                const file1Desc = document.getElementById('file1Desc');
                if (file1Desc) file1Desc.textContent = translations[lang]?.file1Desc || 'Drag and drop or click to select';
                const file2Desc = document.getElementById('file2Desc');
                if (file2Desc) file2Desc.textContent = translations[lang]?.file2Desc || 'Drag and drop or click to select';
                const compareBtn = document.getElementById('compareBtn');
                if (compareBtn) compareBtn.querySelector('span').nextSibling.textContent = translations[lang]?.compare || 'Compare';
                const exportBtn = document.getElementById('exportBtn');
                if (exportBtn) exportBtn.querySelector('span').nextSibling.textContent = translations[lang]?.export || 'Export to Excel';
                const refreshBtn = document.getElementById('refreshBtn');
                if (refreshBtn) refreshBtn.querySelector('span').nextSibling.textContent = translations[lang]?.refresh || 'Refresh';
                const saveTemplateBtn = document.getElementById('saveTemplateBtn');
                if (saveTemplateBtn) saveTemplateBtn.querySelector('span').nextSibling.textContent = translations[lang]?.saveTemplate || 'Save Template';
                
                // C·∫≠p nh·∫≠t ph·∫ßn b·ªô l·ªçc
                const filtersTitle = document.getElementById('filtersTitle');
                    if (filtersTitle) filtersTitle.textContent = `üîß ${translations[lang]?.filter?.filtersTitle || 'Filters'}`;
                    
                    const validityFilterLabel = document.getElementById('validityFilterLabel');
                    if (validityFilterLabel) validityFilterLabel.textContent = translations[lang]?.filter?.validity || 'Validity';
                    
                    const billcodeSearchLabel = document.getElementById('billcodeSearchLabel');
                    if (billcodeSearchLabel) billcodeSearchLabel.textContent = translations[lang]?.filter?.billcodeSearch || 'Search Billcode';
                    
                    const diffFilterLabel = document.getElementById('diffFilterLabel');
                    if (diffFilterLabel) diffFilterLabel.textContent = translations[lang]?.filter?.diffFilter || 'Minimum Difference';
                    
                    const clearFiltersBtn = document.getElementById('clearFiltersBtn');
                    if (clearFiltersBtn) clearFiltersBtn.textContent = translations[lang]?.filter?.clearFilters || 'Clear Filters';
                    
                    const validityFilter = document.getElementById('validityFilter');
                    if (validityFilter) {
                        validityFilter.options[0].text = translations[lang]?.all || 'All';
                        validityFilter.options[1].text = translations[lang]?.valid || 'Valid';
                        validityFilter.options[2].text = translations[lang]?.invalid || 'Invalid';
                    }
                    
                    const billcodeSearch = document.getElementById('billcodeSearch');
                    if (billcodeSearch) billcodeSearch.placeholder = translations[lang]?.filter?.billcodeSearch || 'Enter billcode...';
                    
                    const diffFilter = document.getElementById('diffFilter');
                    if (diffFilter) diffFilter.placeholder = translations[lang]?.filter?.diffFilter || 'Minimum Difference';
                    
                    if (this.results) {
                        this.renderResults();
                        this.renderChart();
                    }
                }

            setTheme(theme) {
                this.theme = theme;
                localStorage.setItem('theme', theme);
                document.documentElement.setAttribute('data-theme', theme);
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) themeIcon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                if (this.chartInstance) {
                    this.renderChart();
                }
            }

            toggleTheme() {
                this.setTheme(this.theme === 'light' ? 'dark' : 'light');
            }

            showHelp() {
                this.showAlert('info', translations[this.currentLang]?.alert?.info?.replace('%s', `
                    H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:
                    1. T·∫£i l√™n file Excel/CSV b·∫±ng c√°ch k√©o th·∫£ ho·∫∑c click v√†o khu v·ª±c t·∫£i file
                    2. Nh·∫•n n√∫t So s√°nh ƒë·ªÉ ph√¢n t√≠ch d·ªØ li·ªáu
                    3. S·ª≠ d·ª•ng b·ªô l·ªçc ƒë·ªÉ xem k·∫øt qu·∫£ c·ª• th·ªÉ
                    4. Xu·∫•t k·∫øt qu·∫£ ra Excel ho·∫∑c l∆∞u m·∫´u ƒë·ªÉ s·ª≠ d·ª•ng sau
                    5. Nh·∫•n L√†m m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu l·∫°i
                `) || `
                    Instructions:
                    1. Upload Excel/CSV files by dragging or clicking the upload area
                    2. Click Compare to analyze data
                    3. Use filters to view specific results
                    4. Export results to Excel or save as a template
                    5. Click Refresh to start over
                `);
            }

            setupEvents() {
                const billcodeSearch = document.getElementById('billcodeSearch');
                const diffFilter = document.getElementById('diffFilter');
                const debounce = (func, delay) => {
                    let timeoutId;
                    return (...args) => {
                        clearTimeout(timeoutId);
                        timeoutId = setTimeout(() => func.apply(this, args), delay);
                    };
                };
                const debouncedApplyFilters = debounce(this.applyFilters.bind(this), 300);
                if (billcodeSearch) billcodeSearch.addEventListener('keyup', debouncedApplyFilters);
                if (diffFilter) diffFilter.addEventListener('keyup', debouncedApplyFilters);
            }
            renderBillcodeChart(data) {
                const canvas = document.getElementById('billcodeChart');
                if (!canvas || !data?.length) return;

                const ctx = canvas.getContext('2d');

                // H·ªßy bi·ªÉu ƒë·ªì c≈© n·∫øu c√≥
                if (this.billChartInstance) {
                    this.billChartInstance.destroy();
                }

                this.billChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(row => row.billcode),
                        datasets: [{
                            label: translations[this.currentLang]?.chart?.difference || 'Difference',
                            data: data.map(row => parseFloat(row.difference) || 0),
                            backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56', '#4BC0C0', '#9966FF'],
                            borderColor: ['#36A2EB', '#FF6384', '#FFCE56', '#4BC0C0', '#9966FF'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: translations[this.currentLang]?.chart?.amount || 'Amount'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Billcode'
                                }
                            }
                        }
                    }
                });

                const chartDetails = document.getElementById('chartDetails');
                if (chartDetails) {
                    const total = data.reduce((sum, r) => sum + (parseFloat(r.difference) || 0), 0);
                    chartDetails.innerHTML = `<ul><li><strong>Total Difference:</strong> ${total.toFixed(2)}</li></ul>`;
                }
            }

        }

        document.addEventListener('DOMContentLoaded', () => {
            const app = new ExcelCompareApp();
            app.init();
        });
    </script>
</body>
</html>
