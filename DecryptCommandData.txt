public static string DecryptCommandData(string base64CipherText, string partnerToken)
{
    var parts = partnerToken.Split(':');
    if (parts.Length != 2)
        throw new ArgumentException("PartnerToken không hợp lệ (phải có dạng base64key:base64iv)");

    byte[] key = Convert.FromBase64String(parts[0]);
    byte[] iv = Convert.FromBase64String(parts[1]);

    byte[] cipherBytes = Convert.FromBase64String(base64CipherText);

    using var aes = Aes.Create();
    aes.KeySize = 256;
    aes.BlockSize = 128;
    aes.Key = key;
    aes.IV = iv;
    aes.Mode = CipherMode.CBC;
    aes.Padding = PaddingMode.PKCS7;

    using var decryptor = aes.CreateDecryptor(aes.Key, aes.IV);
    using var msDecrypt = new MemoryStream(cipherBytes);
    using var cs = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read);
    using var decompressedStream = new MemoryStream();

    using (var gzip = new GZipStream(cs, CompressionMode.Decompress))
    {
        gzip.CopyTo(decompressedStream);
    }

    byte[] decompressedBytes = decompressedStream.ToArray();
    return Encoding.UTF8.GetString(decompressedBytes);
}
